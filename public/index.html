<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description"
          content="Motus is a news sharing website that personalises itself to the user not the audience.">
    <meta property="og:description"
          content="Motus is a news sharing website that personalises itself to the user not the audience."/>
    <meta property="og:image" content="preview.jpg"/>
    <meta name="author" content="Liam Read">
    <link rel="icon" type="image/png" href="/favicon.png">

    <!-- Custom Meta title tags -->
    <meta property="og:title" content="Motus - Very Personal News"/>
    <title>Motus - Very Personal News</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" type="text/css" rel="stylesheet">
    <link href="/public/css/style.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="http://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="http://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/list.js/1.1.0/list.min.js"></script>
</head>
<body>
<header>
    <nav class="navbar navbar-lg main-navbar" role="navigation" id="top-navigation">
        <div class="container nopad">
            <div class="row">
                <!-- Mobile Only -->
                <div class="navbar-header">
                    <a class="brand" style="margin: 0; float: none;" href="/home">
                        <img src="/public/images/logos/logo.png"/>
                    </a>
                    <!--                            <img src="/images/logos/logo.png" class="img-responsive pull-left logo-xs" alt="logo here">-->
                    <button type="button" class="navbar-toggle pull-right">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="nav-menu-line"></span>
                        <span class="nav-menu-line"></span>
                        <span class="nav-menu-line"></span>
                    </button>
                </div>
                <!-- Main Navigation -->
                <div class="collapse navbar-collapse">
                    <ul class="nav main-links navbar-nav navbar-left">
                        <li><a href="/home">Home</a></li>
                        <li><a href="/about">About</a></li>
                        <li><a href="/mission">Mission Statement</a></li>
                    </ul>
                    <ul class="nav social-links navbar-nav navbar-right">
                        <li><a target="_blank" class="facebook" href=""><i class="fa fa-facebook"></i></a></li>
                        <li><a target="_blank" class="twitter" href=""><i class="fa fa-twitter"></i></a></li>
                        <li><a target="_blank" class="linkedin" href=""><i class="fa fa-linkedin"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
</header>

<script>
    var socket = io();

    function client(socket) {

        this.id = null;
        this.referrer = document.referrer;
        this.reso = [window.screen.availHeight, window.screen.availWidth];

        this.setId = function (id) {
            this.id = id;
        };

        /**
         * Returns a referral address if one exists otherwise nothing is passed.
         */
        this.getReferringDocument = function () {
            if (!this.referrer) {
                return 'none';
            } else {
                return this.referrer;
            }
        };

        /**
         * This is called when finding the starting resolution.
         * @returns {[*,*]}
         */
        this.getRes = function () {
            this.reso = [window.screen.availHeight, window.screen.availWidth];
        };

        /**
         * Checks if a Cookie has been presented before collecting information.
         */
        this.checkForCookie = function () {
            if (!document.cookie) {
                socket.emit('registerUser', {});
            } else {
                console.log("Cookie from previous session found");
                var id = decipherCookie('id');
                this.setId(id);
                //emit the ID found in the cookie and also the path we received.
                socket.emit('assignOldUser', {
                    id: this.id
                });
            }
        };

        /**
         * Adds a new cookie for the user to track them across the website
         */
        this.addCookie = function (id) {
            var cookieString = 'id=' + id + ';' + ' createdAt=' + window.location.pathname + ';';
            document.cookie = cookieString;
            this.id = id;
            console.log("new cookie generated for user's session");
        };

        function collectInitalData() {

        }

        /**
         * Deciphers a cookie string into a use able javascript array.
         * @param ref the cookies ref we are looking to extract.
         */
        function decipherCookie(ref) {
            var decodedCookie = decodeURIComponent(document.cookie);
            var cookieArr = decodedCookie.split(';');
            var resultCookieArr = chunkArrOfPieces(cookieArr);

            switch (ref) {
                case 'id':
                    return resultCookieArr[0][1];
                    break;
                case 'createdAt':
                    return resultCookieArr[1][1];
                    break;
            }
        }

        /**
         * Helper function that takes an array splits the values by = and then returns a multi dimensional array with
         * key => value style arrays inside.
         * @param cookieArr
         * @returns {Array}
         */
        function chunkArrOfPieces(cookieArr) {
            var result = [];
            for (var x = 0; x < cookieArr.length; x++) {
                var pieces = cookieArr[x].split('=');
                result.push(pieces);
            }
            return result;

        }

        /**
         * Deletes the current cookie by setting it's expires field to yesterday.
         */
        this.deleteCookie = function (name) {
            document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        };

        function collectDataNewUser() {

        }

    }

    var thisClient = new client(socket);

    thisClient.checkForCookie();

    //thisClient.deleteCookie('id');

    /**
     * This event is triggered when the server tells the user that a client instance has been generated for them.
     */
    socket.on('addCookieForUser', function (data) {
        console.log('Attempting to add a cookie for a user');
        console.log(data.id);
        thisClient.addCookie(data.id);
    });

    setInterval(function () {
        console.log(thisClient);
    }, 7000);

</script>

<div class="page-wrapper">
    <div class="container-fluid">
        <div class="container">
            <div class="row home-pane-panel ">
                <div class="col-xs-12 col-md-3 home-pane-user nopad">
                    <div class="col-md-12 user-tile-col">
                        <div class="user-tile">
                            <div class="user-thumbnail">
                                <img src="/public/images/default/thumbnail/default-thumbnail-wallpaper.jpg"
                                     alt="Add some flair to your news profile">
                            </div>
                            <div class="user-stats text-center row">
                                <div class="col-md-12"><h5><i class="fa fa-calendar"></i> <span id="datetime"></span>
                                </h5></div>
                            </div>
                            <div class="user-info text-center">
                                <h3>Anonymous</h3>
                                <p id="loc">
                                <p>
                                <p id="ip"></p>
                            </div>
                            <div class="user-actions text-center">
                                <a class="btn btn-action" href="">Register</a>
                                <a class="btn btn-action" href="">Sign in</a>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12 user-reading-col">
                        <div class="user-tile">
                            <div class="text-center">
                                <h3>Your Pinned Articles</h3>
                            </div>
                            <div class="pinned-articles">
                                <ul>
                                    <li><a href="">Hello World</a>
                                        <p> - A short introduction to life</p></li>
                                    <li><a href="">Hello World</a>
                                        <p> - A short introduction to life</p></li>
                                    <li><a href="">Hello World</a>
                                        <p> - A short introduction to life</p></li>
                                    <li><a href="">Hello World</a>
                                        <p> - A short introduction to life</p></li>
                                    <li><a href="">Hello World</a>
                                        <p> - A short introduction to life</p></li>
                                    <li><a href="">Hello World</a>
                                        <p> - A short introduction to life</p></li>
                                    <li><a href="">Hello World</a>
                                        <p> - A short introduction to life</p></li>
                                </ul>
                            </div>
                        </div>
                    </div>


                    <div class="col-md-12 user-question-col">
                        <div class="user-tile">
                            <div class="text-center">
                                <div>
                                    <h3>Questionnaire</h3>
                                </div>
                                <div class="question-container">
                                    <p>How personal is too personal?</p>
                                    <div class="form-group">
                                        <div class="col-md-12 question-text-box">
                                            <input type="text" placeholder="Answer here" class="form-control"
                                                   id="input-question-area">
                                        </div>
                                    </div>
                                    <button class="btn btn-default">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="col-xs-9 home-pane-main nopad">
                    <div class="news-hub ">
                        <div class="grid">

                            <div class="grid-item">
                                <img class='news-image' src='/public/images/default/news/default1.jpg'>
                                <div class='news-text'>
                                    <p>Title Goes here</p>
                                </div>

                            </div>


                            <div class="grid-item">
                                <img src='/public/images/default/news/default2.jpg'>

                            </div>
                            <div class="grid-item"><img src='/public/images/default/news/default3.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default4.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default5.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default3.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default2.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default4.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default1.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default2.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default3.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default4.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default5.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default3.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default2.jpg'></div>
                            <div class="grid-item"><img src='/public/images/default/news/default4.jpg'></div>

                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>

<script>

    var datetime = null,
        date = null;
    var update = function () {
        date = moment(new Date());
        datetime.html(date.format('MMMM Do YYYY h:mm a'));
    };

    $(document).ready(function () {
        datetime = $('#datetime')
        update();
        setInterval(update, 1000);
    });

    $.get("http://ipinfo.io", function (response) {
        $("#ip").html(response.ip);
        $("#loc").html(response.city + ", " + response.region);
    }, "jsonp");

    $(document).ready(function () {
        var $grid = $('.grid').packery({
            itemSelector: '.grid-item',
            percentPosition: true
        });
        // layout Packery after each image loads
        $grid.imagesLoaded().progress(function () {
            $grid.packery();
        });
    });
</script>


</div>
<!--- /PAGE WRAPPER  --->

<!-- Custom Google Fonts -->
<link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
<!-- Bootstrap -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" type="text/javascript"></script>
<!-- Animate.css -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.1/animate.min.css" type="text/css" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
<!-- momentjs-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.2/moment.min.js"></script>
<!-- packer js-->
<script src="https://unpkg.com/packery@2.1/dist/packery.pkgd.js"></script>
<script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>
</body>
</html>